# Архитектура приложения

Проект построен по принципу **feature-based** модулей с чёткими границами и готовностью к масштабированию.

## Слои

```
src/
├── app/           # Инициализация приложения: роутер, провайдеры, маршруты
├── features/      # Функциональные модули (один каталог = одна фича)
├── shared/        # Общие компоненты, хуки, утилиты, lib
├── styles/        # Глобальные стили
├── main.tsx
└── App.tsx
```

- **app** — не содержит бизнес-логики; только сборка роутов и провайдеров.
- **features** — каждая фича изолирована: свои компоненты, сервисы, store, типы, утилиты.
- **shared** — только то, что реально переиспользуется между фичами; не дублировать фиче-специфичную логику.

## Структура фичи

Один модуль (фича) — одна папка в `features/`:

```
features/
├── nutrition/
│   ├── components/   # UI фичи
│   ├── services/    # Работа с данными, API, валидация
│   ├── store/       # Состояние (например Zustand)
│   ├── types/       # Типы только этой фичи
│   ├── utils/       # Вспомогательные функции фичи
│   └── index.ts     # Публичный API фичи (обязательно)
└── splash/
    ├── SplashScreen.tsx
    └── index.ts
```

**Правило:** код снаружи фичи импортирует **только из `features/<name>/index.ts`**, не из внутренних папок (`components/`, `services/` и т.д.). Так изменение внутренней реализации не задевает другие модули.

## Публичный API фичи

В `features/<name>/index.ts` экспортируются:

- компоненты страниц/экранов для роутера;
- хуки и типы, которые нужны другим фичам или `app`;
- **не** экспортируются внутренние сервисы, утилиты и компоненты, используемые только внутри фичи.

Пример:

```ts
// features/nutrition/index.ts
export { MainScreen } from './components/MainScreen'
export { useNutritionStore } from './store/nutritionStore'
export type { NutritionEntry, Product, DailyNutrition, MealType } from './types'
```

## Добавление новой фичи

1. Создать папку `features/<new-feature>/`.
2. Реализовать модуль: `components/`, `services/`, `store/`, `types/`, при необходимости `utils/`.
3. Добавить `features/<new-feature>/index.ts` с публичным API.
4. В `app/routes.ts` добавить путь для новой фичи.
5. В `app/router.tsx` добавить импорт из `@/features/<new-feature>` и `<Route>`.

Зависимости между фичами — только через публичный API (и при необходимости через `shared`). Фича не импортирует из другой фичи «внутрь» (например, из её `services/` или `components/`).

## Маршруты

Все пути задаются в `app/routes.ts`. Роутер и экраны (например, splash) импортируют `ROUTES` оттуда, чтобы не дублировать строки и не создавать циклические зависимости.

## Безопасность

- **Ввод:** валидация и санитизация на границе сервиса (в `services/` или отдельном `validation.ts`). Ограничения: длина строк, диапазоны чисел, формат дат.
- **Ошибки:** пользователю показываются только безопасные сообщения (через `shared/utils/errorHandler.ts` — `toUserMessage()`). Внутренние детали (stack, сообщения от API) не отдаются в UI.
- **Supabase:** клиент создаётся только при наличии `VITE_SUPABASE_URL` и `VITE_SUPABASE_ANON_KEY`; фабрика в `shared/lib/supabase.ts` не бросает и не экспортирует ключи.
- **Хранение:** при работе с localStorage ограничен объём данных (лимиты записей/продуктов), парсинг в try/catch, проверка типов после чтения.

## Удаление фичи

При удалении фичи нужно:

1. Удалить папку `features/<name>/`.
2. Убрать маршрут из `app/routes.ts` и `app/router.tsx`.
3. Удалить все импорты из удалённой фичи в других файлах.
4. Проверить `shared/` на использование только этой фичей и при необходимости упростить или удалить.
5. Запустить сборку и тесты.

После этого в проекте не должно остаться ссылок на удалённую фичу.
